#!/usr/bin/env python3
# -*- coding: utf-8 -*-

"""
–°–∫—Ä–∏–ø—Ç –¥–ª—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è –¥–ª—è Telegram –±–æ—Ç–∞
"""

import os
import json

def setup_environment():
    """–ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è"""
    print("üîß –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è –¥–ª—è Telegram –±–æ—Ç–∞")
    print("=" * 50)
    
    # –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π .env —Ñ–∞–π–ª
    env_file = '.env'
    env_data = {}
    
    if os.path.exists(env_file):
        print(f"üìÅ –ù–∞–π–¥–µ–Ω —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π —Ñ–∞–π–ª {env_file}")
        with open(env_file, 'r', encoding='utf-8') as f:
            for line in f:
                line = line.strip()
                if line and not line.startswith('#') and '=' in line:
                    key, value = line.split('=', 1)
                    env_data[key] = value
    
    # –ó–∞–ø—Ä–∞—à–∏–≤–∞–µ–º BOT_TOKEN
    print("\nü§ñ –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Ç–æ–∫–µ–Ω–∞ –±–æ—Ç–∞:")
    if 'BOT_TOKEN' in env_data:
        print(f"   –¢–µ–∫—É—â–∏–π —Ç–æ–∫–µ–Ω: {env_data['BOT_TOKEN'][:10]}...")
        change = input("   –ò–∑–º–µ–Ω–∏—Ç—å —Ç–æ–∫–µ–Ω? (y/N): ").lower().strip()
        if change == 'y':
            new_token = input("   –í–≤–µ–¥–∏—Ç–µ –Ω–æ–≤—ã–π —Ç–æ–∫–µ–Ω –±–æ—Ç–∞: ").strip()
            if new_token:
                env_data['BOT_TOKEN'] = new_token
    else:
        new_token = input("   –í–≤–µ–¥–∏—Ç–µ —Ç–æ–∫–µ–Ω –±–æ—Ç–∞: ").strip()
        if new_token:
            env_data['BOT_TOKEN'] = new_token
    
    # –ó–∞–ø—Ä–∞—à–∏–≤–∞–µ–º ADMIN_USER_ID
    print("\nüë§ –ù–∞—Å—Ç—Ä–æ–π–∫–∞ ID –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞:")
    if 'ADMIN_USER_ID' in env_data:
        print(f"   –¢–µ–∫—É—â–∏–π ID: {env_data['ADMIN_USER_ID']}")
        change = input("   –ò–∑–º–µ–Ω–∏—Ç—å ID? (y/N): ").lower().strip()
        if change == 'y':
            new_id = input("   –í–≤–µ–¥–∏—Ç–µ –≤–∞—à Telegram ID: ").strip()
            if new_id:
                env_data['ADMIN_USER_ID'] = new_id
    else:
        new_id = input("   –í–≤–µ–¥–∏—Ç–µ –≤–∞—à Telegram ID: ").strip()
        if new_id:
            env_data['ADMIN_USER_ID'] = new_id
    
    # –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤ .env —Ñ–∞–π–ª
    with open(env_file, 'w', encoding='utf-8') as f:
        f.write("# Telegram Bot Environment Variables\n")
        f.write("# Generated by setup_env.py\n\n")
        
        for key, value in env_data.items():
            f.write(f"{key}={value}\n")
    
    print(f"\n‚úÖ –§–∞–π–ª {env_file} –æ–±–Ω–æ–≤–ª–µ–Ω!")
    
    # –°–æ–∑–¥–∞–µ–º —Ñ–∞–π–ª—ã –¥–∞–Ω–Ω—ã—Ö –µ—Å–ª–∏ –∏—Ö –Ω–µ—Ç
    print("\nüìÅ –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Ñ–∞–π–ª–æ–≤ –¥–∞–Ω–Ω—ã—Ö...")
    
    files_to_create = {
        'notifications.json': {},
        'bot_settings.json': {
            'daily_summary_time': '09:00',
            'timezone': 'Europe/Moscow'
        },
        'price_history.json': {}
    }
    
    for filename, default_data in files_to_create.items():
        if not os.path.exists(filename):
            with open(filename, 'w', encoding='utf-8') as f:
                json.dump(default_data, f, ensure_ascii=False, indent=2)
            print(f"   ‚úÖ –°–æ–∑–¥–∞–Ω {filename}")
        else:
            print(f"   üìÅ {filename} —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç")
    
    print("\nüéâ –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞!")
    print("\nüìã –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏:")
    print("1. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ —Ñ–∞–π–ª .env —Å–æ–¥–µ—Ä–∂–∏—Ç –ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ")
    print("2. –ó–∞–ø—É—Å—Ç–∏—Ç–µ –±–æ—Ç–∞: python admin_bot.py")
    print("3. –û—Ç–ø—Ä–∞–≤—å—Ç–µ /start –±–æ—Ç—É")
    print("4. –î–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –µ–∂–µ–¥–Ω–µ–≤–Ω–æ–π —Å–≤–æ–¥–∫–∏ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ /test_daily")

if __name__ == '__main__':
    setup_environment() 