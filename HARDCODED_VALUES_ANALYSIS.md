# üîç –ü–û–î–†–û–ë–ù–´–ô –ê–ù–ê–õ–ò–ó: –ñ–ï–°–¢–ö–û –ó–ê–ö–û–î–ò–†–û–í–ê–ù–ù–´–ï –ó–ù–ê–ß–ï–ù–ò–Ø (FALLBACK –ö–£–†–°–´)

## üìã –í–í–ï–î–ï–ù–ò–ï

–í –∫–æ–¥–µ –±–æ—Ç–∞ –æ–±–Ω–∞—Ä—É–∂–µ–Ω—ã **–º–∞–≥–∏—á–µ—Å–∫–∏–µ —á–∏—Å–ª–∞** (hardcoded values), –∫–æ—Ç–æ—Ä—ã–µ –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –∫–∞–∫ fallback –∑–Ω–∞—á–µ–Ω–∏—è –ø—Ä–∏ –æ—à–∏–±–∫–∞—Ö –ø–æ–ª—É—á–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö –æ—Ç API. –≠—Ç–∏ –∑–Ω–∞—á–µ–Ω–∏—è:
1. **–ù–µ –æ—Ç—Ä–∞–∂–∞—é—Ç —Ä–µ–∞–ª—å–Ω—É—é —Å–∏—Ç—É–∞—Ü–∏—é** - –º–æ–≥—É—Ç –±—ã—Ç—å —É—Å—Ç–∞—Ä–µ–≤—à–∏–º–∏
2. **–°–ª–æ–∂–Ω–æ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—Ç—å** - –Ω—É–∂–Ω–æ –∏—Å–∫–∞—Ç—å –ø–æ –≤—Å–µ–º—É –∫–æ–¥—É –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏
3. **–ù–µ –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞—é—Ç—Å—è** - –Ω–µ–≤–æ–∑–º–æ–∂–Ω–æ –∏–∑–º–µ–Ω–∏—Ç—å –±–µ–∑ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –∫–æ–¥–∞
4. **–ù–µ—Ç –¥–æ–∫—É–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∏—è** - –Ω–µ—è—Å–Ω–æ, –æ—Ç–∫—É–¥–∞ –≤–∑—è–ª–∏—Å—å —ç—Ç–∏ –∑–Ω–∞—á–µ–Ω–∏—è

---

## üî¥ –ù–ê–ô–î–ï–ù–ù–´–ï –ü–†–û–ë–õ–ï–ú–´

### 1. Fallback –∫—É—Ä—Å USD/RUB = 80

**–ú–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–µ:** `admin_bot.py`, —Å—Ç—Ä–æ–∫–∞ 361

**–ö–æ–¥:**
```python
except Exception as e:
    logger.error(f"–û—à–∏–±–∫–∞ –ø–æ–ª—É—á–µ–Ω–∏—è –∫—É—Ä—Å–∞ FOREX: {e}")
    if usd_to_rub_rate == 0:
        usd_to_rub_rate = 80  # Fallback –∑–Ω–∞—á–µ–Ω–∏–µ
```

**–ü—Ä–æ–±–ª–µ–º–∞:**
- –ö—É—Ä—Å –¥–æ–ª–ª–∞—Ä–∞ –∫ —Ä—É–±–ª—é **–Ω–µ —Ä–∞–≤–µ–Ω 80** —É–∂–µ –º–Ω–æ–≥–æ –ª–µ—Ç
- –ù–∞ –º–æ–º–µ–Ω—Ç –Ω–∞–ø–∏—Å–∞–Ω–∏—è –∫–æ–¥–∞ (–ø—Ä–∏–º–µ—Ä–Ω–æ 2024-2025) –∫—É—Ä—Å USD/RUB –∫–æ–ª–µ–±–ª–µ—Ç—Å—è –≤ —Ä–∞–π–æ–Ω–µ **85-100 —Ä—É–±**
- –ï—Å–ª–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∑–Ω–∞—á–µ–Ω–∏–µ 80, –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –±—É–¥—É—Ç –≤–∏–¥–µ—Ç—å **–Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ —Ü–µ–Ω—ã** –≤ —Ä—É–±–ª—è—Ö –¥–ª—è –∫—Ä–∏–ø—Ç–æ–≤–∞–ª—é—Ç, –∞–∫—Ü–∏–π –∏ –¥—Ä—É–≥–∏—Ö –∞–∫—Ç–∏–≤–æ–≤

**–ü—Ä–∏–º–µ—Ä –Ω–µ–≥–∞—Ç–∏–≤–Ω–æ–≥–æ –≤–ª–∏—è–Ω–∏—è:**
```
–†–µ–∞–ª—å–Ω—ã–π –∫—É—Ä—Å: 92 ‚ÇΩ/$
Fallback –∫—É—Ä—Å: 80 ‚ÇΩ/$

BTC —Å—Ç–æ–∏—Ç $50,000:
- –ü—Ä–∞–≤–∏–ª—å–Ω–æ: 50,000 √ó 92 = 4,600,000 ‚ÇΩ
- –° fallback: 50,000 √ó 80 = 4,000,000 ‚ÇΩ
- –†–∞–∑–Ω–∏—Ü–∞: 600,000 ‚ÇΩ (13% –æ—à–∏–±–∫–∞!)
```

**–ö–æ–≥–¥–∞ —Å—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç:**
- –û—à–∏–±–∫–∞ –ø–æ–ª—É—á–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö –æ—Ç –¶–ë –†–§ (API –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω)
- –û—à–∏–±–∫–∞ –ø–æ–ª—É—á–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö –æ—Ç FOREX API
- –û–±–∞ –∏—Å—Ç–æ—á–Ω–∏–∫–∞ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω—ã –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ

---

### 2. –†–∞—Å—á–µ—Ç —Å–µ—Ä–µ–±—Ä–∞ –æ—Ç –∑–æ–ª–æ—Ç–∞: —Å–æ–æ—Ç–Ω–æ—à–µ–Ω–∏–µ 1:80

**–ú–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–µ:** `data_sources.py`, —Å—Ç—Ä–æ–∫–∏ 368-377

**–ö–æ–¥:**
```python
# Fallback –¥–ª—è —Å–µ—Ä–µ–±—Ä–∞
if 'silver' not in commodities_data and 'gold' in commodities_data:
    logger.debug("–°–µ—Ä–µ–±—Ä–æ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–æ, —Ä–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ–º –æ—Ç –∑–æ–ª–æ—Ç–∞...")
    gold_price = commodities_data['gold']['price']
    silver_fallback = gold_price / 80
    commodities_data['silver'] = {
        'name': '–°–µ—Ä–µ–±—Ä–æ (—Ä–∞—Å—á–µ—Ç–Ω–æ–µ)',
        'price': silver_fallback,
        'currency': 'USD'
    }
    logger.info(f"‚úÖ –°–µ—Ä–µ–±—Ä–æ —Ä–∞—Å—Å—á–∏—Ç–∞–Ω–æ: ${silver_fallback:.2f}")
```

**–ü—Ä–æ–±–ª–µ–º–∞:**
- –°–æ–æ—Ç–Ω–æ—à–µ–Ω–∏–µ –∑–æ–ª–æ—Ç–æ/—Å–µ—Ä–µ–±—Ä–æ **–Ω–µ —è–≤–ª—è–µ—Ç—Å—è –ø–æ—Å—Ç–æ—è–Ω–Ω—ã–º** –∏ –∫–æ–ª–µ–±–ª–µ—Ç—Å—è
- –ò—Å—Ç–æ—Ä–∏—á–µ—Å–∫–∏ —Å–æ–æ—Ç–Ω–æ—à–µ–Ω–∏–µ –º–µ–Ω—è–ª–æ—Å—å –æ—Ç **15:1 –¥–æ 100:1**
- –í 2024-2025 –≥–æ–¥–∞—Ö —Å–æ–æ—Ç–Ω–æ—à–µ–Ω–∏–µ –ø—Ä–∏–º–µ—Ä–Ω–æ **75-85:1**
- –ó–Ω–∞—á–µ–Ω–∏–µ **80** –º–æ–∂–µ—Ç –±—ã—Ç—å –±–æ–ª–µ–µ-–º–µ–Ω–µ–µ –±–ª–∏–∑–∫–∏–º, –Ω–æ:
  - –ù–µ –æ—Ç—Ä–∞–∂–∞–µ—Ç —Ä–µ–∞–ª—å–Ω—É—é –≤–æ–ª–∞—Ç–∏–ª—å–Ω–æ—Å—Ç—å
  - –ù–µ —É—á–∏—Ç—ã–≤–∞–µ—Ç –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤ —Å–æ–æ—Ç–Ω–æ—à–µ–Ω–∏–∏
  - –°–æ–∑–¥–∞–µ—Ç –ª–æ–∂–Ω–æ–µ –≤–ø–µ—á–∞—Ç–ª–µ–Ω–∏–µ —Ç–æ—á–Ω–æ—Å—Ç–∏

**–†–µ–∞–ª—å–Ω–æ–µ —Å–æ–æ—Ç–Ω–æ—à–µ–Ω–∏–µ:**
```
–ó–æ–ª–æ—Ç–æ: $2,000/oz
–°–µ—Ä–µ–±—Ä–æ: $25/oz
–†–µ–∞–ª—å–Ω–æ–µ —Å–æ–æ—Ç–Ω–æ—à–µ–Ω–∏–µ: 80:1 ‚úÖ (–≤ –¥–∞–Ω–Ω–æ–º —Å–ª—É—á–∞–µ —Å–æ–≤–ø–∞–ª–æ)

–ù–æ —á–µ—Ä–µ–∑ –º–µ—Å—è—Ü:
–ó–æ–ª–æ—Ç–æ: $2,100/oz
–°–µ—Ä–µ–±—Ä–æ: $28/oz
–†–µ–∞–ª—å–Ω–æ–µ —Å–æ–æ—Ç–Ω–æ—à–µ–Ω–∏–µ: 75:1
Fallback –¥–∞—Å—Ç: $2,100 / 80 = $26.25 (–æ—à–∏–±–∫–∞ ~6%)
```

---

### 3. –ö–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è USO ETF –≤ Brent: –º–Ω–æ–∂–∏—Ç–µ–ª—å √ó12

**–ú–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–µ:** `data_sources.py`, —Å—Ç—Ä–æ–∫–∏ 347-365

**–ö–æ–¥:**
```python
# Fallback: Alpha Vantage –¥–ª—è –Ω–µ—Ñ—Ç–∏ WTI
if 'brent' not in commodities_data:
    logger.debug("EIA –Ω–µ —Å—Ä–∞–±–æ—Ç–∞–ª, –ø—Ä–æ–±—É–µ–º Alpha Vantage USO ETF...")
    try:
        url = f"https://www.alphavantage.co/query?function=GLOBAL_QUOTE&symbol=USO&apikey={ALPHA_VANTAGE_KEY}"
        async with session.get(url, timeout=_TIMEOUT) as resp:
            if resp.status == 200:
                oil_data = await resp.json()
                if 'Global Quote' in oil_data and '05. price' in oil_data['Global Quote']:
                    oil_price = float(oil_data['Global Quote']['05. price'])
                    estimated_oil_price = oil_price * 12  # ‚ö†Ô∏è –ú–ê–ì–ò–ß–ï–°–ö–û–ï –ß–ò–°–õ–û
                    commodities_data['brent'] = {
                        'name': '–ù–µ—Ñ—Ç—å Brent (–ø—Ä–∏–±–ª–∏–∑.)',
                        'price': estimated_oil_price,
                        'currency': 'USD'
                    }
```

**–ü—Ä–æ–±–ª–µ–º–∞:**
- **USO ETF** - —ç—Ç–æ —Ñ–æ–Ω–¥, –∫–æ—Ç–æ—Ä—ã–π –æ—Ç—Å–ª–µ–∂–∏–≤–∞–µ—Ç —Ü–µ–Ω—É –Ω–µ—Ñ—Ç–∏, –Ω–æ **–Ω–µ —Ä–∞–≤–µ–Ω —Ü–µ–Ω–µ Brent –Ω–∞–ø—Ä—è–º—É—é**
- –ú–Ω–æ–∂–∏—Ç–µ–ª—å **√ó12** - —ç—Ç–æ –æ—á–µ–Ω—å –≥—Ä—É–±–æ–µ –ø—Ä–∏–±–ª–∏–∂–µ–Ω–∏–µ
- –†–µ–∞–ª—å–Ω–æ–µ —Å–æ–æ—Ç–Ω–æ—à–µ–Ω–∏–µ –∑–∞–≤–∏—Å–∏—Ç –æ—Ç:
  - –¢–∏–ø–∞ –Ω–µ—Ñ—Ç–∏ (Brent vs WTI)
  - –í–æ–ª–∞—Ç–∏–ª—å–Ω–æ—Å—Ç–∏ —Ä—ã–Ω–∫–∞
  - –ü—Ä–µ–º–∏–π/–¥–∏—Å–∫–æ–Ω—Ç–æ–≤ —Ñ–æ–Ω–¥–∞
  - –í—Ä–µ–º–µ–Ω–Ω—ã—Ö —Ñ–∞–∫—Ç–æ—Ä–æ–≤

**–ü—Ä–∏–º–µ—Ä –ø—Ä–æ–±–ª–µ–º—ã:**
```
USO ETF —Ü–µ–Ω–∞: $60
–ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è: $60 √ó 12 = $720 ‚ùå (–∞–±—Å—É—Ä–¥–Ω–æ!)

–†–µ–∞–ª—å–Ω–∞—è —Ü–µ–Ω–∞ Brent: ~$80-90
–ü—Ä–∞–≤–∏–ª—å–Ω–æ–µ —Å–æ–æ—Ç–Ω–æ—à–µ–Ω–∏–µ: ~$60 √ó 1.3-1.5 = $78-90

–†–∞–∑–Ω–∏—Ü–∞: ~10-15% –æ—à–∏–±–∫–∞
```

**–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ:** –í–µ—Ä–æ—è—Ç–Ω–æ, –∞–≤—Ç–æ—Ä –∫–æ–¥–∞ –∏–º–µ–ª –≤ –≤–∏–¥—É –¥—Ä—É–≥–æ–µ —Å–æ–æ—Ç–Ω–æ—à–µ–Ω–∏–µ –∏–ª–∏ —ç—Ç–æ –æ—à–∏–±–∫–∞. –ú–Ω–æ–∂–∏—Ç–µ–ª—å 12 –≤—ã–≥–ª—è–¥–∏—Ç –∫–∞–∫ –æ–ø–µ—á–∞—Ç–∫–∞ –∏–ª–∏ –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ–µ –ø–æ–Ω–∏–º–∞–Ω–∏–µ.

---

### 4. –î—Ä—É–≥–∏–µ –ø–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã

**URALS_DISCOUNT = 3.5** (–≤ `config.py`)
- –≠—Ç–æ –∫–æ–Ω—Å—Ç–∞–Ω—Ç–∞, –Ω–æ –æ–Ω–∞ **–º–æ–∂–µ—Ç –º–µ–Ω—è—Ç—å—Å—è** –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Å–∞–Ω–∫—Ü–∏–π –∏ —Ä—ã–Ω–æ—á–Ω—ã—Ö —É—Å–ª–æ–≤–∏–π
- –•–æ—Ä–æ—à–æ, —á—Ç–æ –æ–Ω–∞ –≤ –∫–æ–Ω—Ñ–∏–≥–µ, –Ω–æ –º–æ–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º–æ–π —á–µ—Ä–µ–∑ env

**DEFAULT_THRESHOLD = 2.0**
- –ü–æ—Ä–æ–≥ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
- –•–æ—Ä–æ—à–æ, —á—Ç–æ –≤ –∫–æ–Ω—Ñ–∏–≥–µ, –Ω–æ –º–æ–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã–º

---

## üí° –†–ï–®–ï–ù–ò–Ø

### –†–µ—à–µ–Ω–∏–µ 1: –ü–µ—Ä–µ–Ω–µ—Å—Ç–∏ –≤—Å–µ –∑–Ω–∞—á–µ–Ω–∏—è –≤ config.py

**–°–æ–∑–¥–∞—Ç—å –∫–æ–Ω—Å—Ç–∞–Ω—Ç—ã:**
```python
# config.py

# Fallback –∫—É—Ä—Å—ã –≤–∞–ª—é—Ç (–∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è —Ç–æ–ª—å–∫–æ –ø—Ä–∏ –ø–æ–ª–Ω–æ–π –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ API)
FALLBACK_USD_RUB_RATE = float(os.getenv('FALLBACK_USD_RUB_RATE', '90.0'))  # –ë–æ–ª–µ–µ –∞–∫—Ç—É–∞–ª—å–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ

# –°–æ–æ—Ç–Ω–æ—à–µ–Ω–∏—è –¥–ª—è —Ä–∞—Å—á–µ—Ç–æ–≤
GOLD_SILVER_RATIO = float(os.getenv('GOLD_SILVER_RATIO', '80.0'))  # –°—Ä–µ–¥–Ω–µ–µ –∏—Å—Ç–æ—Ä–∏—á–µ—Å–∫–æ–µ —Å–æ–æ—Ç–Ω–æ—à–µ–Ω–∏–µ
USO_TO_BRENT_MULTIPLIER = float(os.getenv('USO_TO_BRENT_MULTIPLIER', '1.35'))  # –†–µ–∞–ª—å–Ω–æ–µ —Å–æ–æ—Ç–Ω–æ—à–µ–Ω–∏–µ

# –ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–µ –∏ –º–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è –¥–ª—è –≤–∞–ª–∏–¥–∞—Ü–∏–∏
MIN_USD_RUB_RATE = 50.0
MAX_USD_RUB_RATE = 200.0
```

### –†–µ—à–µ–Ω–∏–µ 2: –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –ø–æ—Å–ª–µ–¥–Ω–µ–µ –∏–∑–≤–µ—Å—Ç–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ

**–•—Ä–∞–Ω–∏—Ç—å –≤ –∫—ç—à–µ –∏–ª–∏ —Ñ–∞–π–ª–µ:**
```python
# –ü—Ä–∏ —É—Å–ø–µ—à–Ω–æ–º –ø–æ–ª—É—á–µ–Ω–∏–∏ –∫—É—Ä—Å–∞ —Å–æ—Ö—Ä–∞–Ω—è–µ–º –µ–≥–æ
CACHE_FILE = 'last_known_rates.json'

def save_last_known_rate(asset: str, rate: float):
    """–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –ø–æ—Å–ª–µ–¥–Ω–∏–π –∏–∑–≤–µ—Å—Ç–Ω—ã–π –∫—É—Ä—Å"""
    try:
        if os.path.exists(CACHE_FILE):
            with open(CACHE_FILE, 'r') as f:
                data = json.load(f)
        else:
            data = {}
        
        data[asset] = {
            'rate': rate,
            'timestamp': datetime.now().isoformat()
        }
        
        with open(CACHE_FILE, 'w') as f:
            json.dump(data, f)
    except Exception as e:
        logger.error(f"–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ –∫—É—Ä—Å–∞: {e}")

def get_last_known_rate(asset: str, max_age_hours: int = 24) -> Optional[float]:
    """–ü–æ–ª—É—á–∏—Ç—å –ø–æ—Å–ª–µ–¥–Ω–∏–π –∏–∑–≤–µ—Å—Ç–Ω—ã–π –∫—É—Ä—Å (–µ—Å–ª–∏ –Ω–µ —Å—Ç–∞—Ä—à–µ max_age_hours)"""
    try:
        if os.path.exists(CACHE_FILE):
            with open(CACHE_FILE, 'r') as f:
                data = json.load(f)
            
            if asset in data:
                rate_info = data[asset]
                timestamp = datetime.fromisoformat(rate_info['timestamp'])
                age_hours = (datetime.now() - timestamp).total_seconds() / 3600
                
                if age_hours <= max_age_hours:
                    return rate_info['rate']
                else:
                    logger.warning(f"–ü–æ—Å–ª–µ–¥–Ω–∏–π –∫—É—Ä—Å {asset} —É—Å—Ç–∞—Ä–µ–ª ({age_hours:.1f} —á–∞—Å–æ–≤)")
    except Exception as e:
        logger.error(f"–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ –∫—É—Ä—Å–∞: {e}")
    
    return None
```

**–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ:**
```python
# –í admin_bot.py
except Exception as e:
    logger.error(f"–û—à–∏–±–∫–∞ –ø–æ–ª—É—á–µ–Ω–∏—è –∫—É—Ä—Å–∞ FOREX: {e}")
    if usd_to_rub_rate == 0:
        # –ü—Ä–æ–±—É–µ–º –≤–∑—è—Ç—å –ø–æ—Å–ª–µ–¥–Ω–µ–µ –∏–∑–≤–µ—Å—Ç–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ
        last_rate = get_last_known_rate('USD_RUB', max_age_hours=24)
        if last_rate:
            usd_to_rub_rate = last_rate
            logger.warning(f"–ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –ø–æ—Å–ª–µ–¥–Ω–∏–π –∏–∑–≤–µ—Å—Ç–Ω—ã–π –∫—É—Ä—Å USD/RUB: {usd_to_rub_rate:.2f}")
        else:
            # –¢–æ–ª—å–∫–æ –µ—Å–ª–∏ –Ω–µ—Ç –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ –∑–Ω–∞—á–µ–Ω–∏—è - –∏—Å–ø–æ–ª—å–∑—É–µ–º fallback
            usd_to_rub_rate = FALLBACK_USD_RUB_RATE
            logger.error(f"–í—Å–µ –∏—Å—Ç–æ—á–Ω–∏–∫–∏ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω—ã, –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è fallback: {usd_to_rub_rate:.2f}")
```

### –†–µ—à–µ–Ω–∏–µ 3: –£–ª—É—á—à–∏—Ç—å —Ä–∞—Å—á–µ—Ç —Å–µ—Ä–µ–±—Ä–∞

**–î–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–π —Ä–∞—Å—á–µ—Ç –Ω–∞ –æ—Å–Ω–æ–≤–µ –∏—Å—Ç–æ—Ä–∏—á–µ—Å–∫–∏—Ö –¥–∞–Ω–Ω—ã—Ö:**
```python
# –í data_sources.py
# Fallback –¥–ª—è —Å–µ—Ä–µ–±—Ä–∞
if 'silver' not in commodities_data and 'gold' in commodities_data:
    logger.debug("–°–µ—Ä–µ–±—Ä–æ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–æ, —Ä–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ–º –æ—Ç –∑–æ–ª–æ—Ç–∞...")
    gold_price = commodities_data['gold']['price']
    
    # –ü—Ä–æ–±—É–µ–º –ø–æ–ª—É—á–∏—Ç—å –ø–æ—Å–ª–µ–¥–Ω–µ–µ –∏–∑–≤–µ—Å—Ç–Ω–æ–µ —Å–æ–æ—Ç–Ω–æ—à–µ–Ω–∏–µ
    last_ratio = get_last_known_rate('GOLD_SILVER_RATIO', max_age_hours=168)  # 1 –Ω–µ–¥–µ–ª—è
    
    if last_ratio:
        silver_fallback = gold_price / last_ratio
    else:
        # –ò—Å–ø–æ–ª—å–∑—É–µ–º –∫–æ–Ω—Å—Ç–∞–Ω—Ç—É –∏–∑ config
        silver_fallback = gold_price / GOLD_SILVER_RATIO
    
    # –°–æ—Ö—Ä–∞–Ω—è–µ–º —Å–æ–æ—Ç–Ω–æ—à–µ–Ω–∏–µ –¥–ª—è –±—É–¥—É—â–µ–≥–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è
    if 'silver' in commodities_data:
        actual_ratio = gold_price / commodities_data['silver']['price']
        save_last_known_rate('GOLD_SILVER_RATIO', actual_ratio)
    
    commodities_data['silver'] = {
        'name': '–°–µ—Ä–µ–±—Ä–æ (—Ä–∞—Å—á–µ—Ç–Ω–æ–µ)',
        'price': silver_fallback,
        'currency': 'USD',
        'note': '–†–∞—Å—Å—á–∏—Ç–∞–Ω–æ –æ—Ç –∑–æ–ª–æ—Ç–∞'
    }
```

### –†–µ—à–µ–Ω–∏–µ 4: –ò—Å–ø—Ä–∞–≤–∏—Ç—å —Ä–∞—Å—á–µ—Ç –Ω–µ—Ñ—Ç–∏ Brent

**–ü—Ä–∞–≤–∏–ª—å–Ω—ã–π —Ä–∞—Å—á–µ—Ç —Å–æ–æ—Ç–Ω–æ—à–µ–Ω–∏—è USO –∫ Brent:**
```python
# –í data_sources.py
# Fallback: Alpha Vantage –¥–ª—è –Ω–µ—Ñ—Ç–∏
if 'brent' not in commodities_data:
    logger.debug("EIA –Ω–µ —Å—Ä–∞–±–æ—Ç–∞–ª, –ø—Ä–æ–±—É–µ–º Alpha Vantage USO ETF...")
    try:
        url = f"https://www.alphavantage.co/query?function=GLOBAL_QUOTE&symbol=USO&apikey={ALPHA_VANTAGE_KEY}"
        async with session.get(url, timeout=_TIMEOUT) as resp:
            if resp.status == 200:
                oil_data = await resp.json()
                if 'Global Quote' in oil_data and '05. price' in oil_data['Global Quote']:
                    uso_price = float(oil_data['Global Quote']['05. price'])
                    
                    # –ü–æ–ª—É—á–∞–µ–º –ø–æ—Å–ª–µ–¥–Ω–µ–µ –∏–∑–≤–µ—Å—Ç–Ω–æ–µ —Å–æ–æ—Ç–Ω–æ—à–µ–Ω–∏–µ –∏–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–µ–º fallback
                    last_multiplier = get_last_known_rate('USO_TO_BRENT', max_age_hours=24)
                    
                    if last_multiplier:
                        estimated_brent = uso_price * last_multiplier
                    else:
                        # –ò—Å–ø–æ–ª—å–∑—É–µ–º –∫–æ–Ω—Å—Ç–∞–Ω—Ç—É –∏–∑ config (–ø—Ä–∞–≤–∏–ª—å–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ ~1.3-1.5)
                        estimated_brent = uso_price * USO_TO_BRENT_MULTIPLIER
                    
                    commodities_data['brent'] = {
                        'name': '–ù–µ—Ñ—Ç—å Brent (–ø—Ä–∏–±–ª–∏–∑.)',
                        'price': estimated_brent,
                        'currency': 'USD',
                        'note': '–†–∞—Å—Å—á–∏—Ç–∞–Ω–æ –æ—Ç USO ETF'
                    }
                    logger.info(f"‚úÖ –ù–µ—Ñ—Ç—å Brent (USO fallback): ${estimated_brent:.2f}")
```

### –†–µ—à–µ–Ω–∏–µ 5: –î–æ–±–∞–≤–∏—Ç—å –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é

**–ò–Ω—Ñ–æ—Ä–º–∏—Ä–æ–≤–∞—Ç—å, –∫–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è fallback –∑–Ω–∞—á–µ–Ω–∏—è:**
```python
# –í —Å–æ–æ–±—â–µ–Ω–∏–∏ –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –¥–æ–±–∞–≤–ª—è—Ç—å –ø–æ–º–µ—Ç–∫—É
if used_fallback:
    message += "\n‚ö†Ô∏è <i>–ù–µ–∫–æ—Ç–æ—Ä—ã–µ –¥–∞–Ω–Ω—ã–µ —Ä–∞—Å—Å—á–∏—Ç–∞–Ω—ã –ø—Ä–∏–±–ª–∏–∑–∏—Ç–µ–ª—å–Ω–æ –∏–∑-–∑–∞ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ API</i>"
```

---

## üìä –°–†–ê–í–ù–ï–ù–ò–ï: –î–û –ò –ü–û–°–õ–ï

### –î–æ (—Ç–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ):

```python
# admin_bot.py:361
usd_to_rub_rate = 80  # Fallback –∑–Ω–∞—á–µ–Ω–∏–µ

# data_sources.py:371
silver_fallback = gold_price / 80

# data_sources.py:357
estimated_oil_price = oil_price * 12  # –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ!
```

**–ü—Ä–æ–±–ª–µ–º—ã:**
- ‚ùå –ó–Ω–∞—á–µ–Ω–∏—è —Ä–∞–∑–±—Ä–æ—Å–∞–Ω—ã –ø–æ –∫–æ–¥—É
- ‚ùå –ù–µ—Ç –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ –∏–∑–º–µ–Ω–∏—Ç—å –±–µ–∑ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –∫–æ–¥–∞
- ‚ùå –ù–µ—Ç —É—á–µ—Ç–∞ –∞–∫—Ç—É–∞–ª—å–Ω–æ—Å—Ç–∏
- ‚ùå –ù–µ—Ç –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤ –¥–∞–Ω–Ω—ã—Ö

### –ü–æ—Å–ª–µ (—Å –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è–º–∏):

```python
# config.py
FALLBACK_USD_RUB_RATE = float(os.getenv('FALLBACK_USD_RUB_RATE', '90.0'))
GOLD_SILVER_RATIO = float(os.getenv('GOLD_SILVER_RATIO', '80.0'))
USO_TO_BRENT_MULTIPLIER = float(os.getenv('USO_TO_BRENT_MULTIPLIER', '1.35'))

# admin_bot.py
from config import FALLBACK_USD_RUB_RATE
usd_to_rub_rate = get_last_known_rate('USD_RUB') or FALLBACK_USD_RUB_RATE

# data_sources.py
from config import GOLD_SILVER_RATIO, USO_TO_BRENT_MULTIPLIER
silver_fallback = gold_price / get_last_known_rate('GOLD_SILVER_RATIO') or GOLD_SILVER_RATIO
estimated_brent = uso_price * get_last_known_rate('USO_TO_BRENT') or USO_TO_BRENT_MULTIPLIER
```

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:**
- ‚úÖ –í—Å–µ –∑–Ω–∞—á–µ–Ω–∏—è –≤ –æ–¥–Ω–æ–º –º–µ—Å—Ç–µ (config.py)
- ‚úÖ –ù–∞—Å—Ç—Ä–∞–∏–≤–∞—é—Ç—Å—è —á–µ—Ä–µ–∑ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è
- ‚úÖ –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –ø–æ—Å–ª–µ–¥–Ω–µ–µ –∏–∑–≤–µ—Å—Ç–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ
- ‚úÖ Fallback —Ç–æ–ª—å–∫–æ –∫–∞–∫ –∫—Ä–∞–π–Ω—è—è –º–µ—Ä–∞
- ‚úÖ –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤ –¥–∞–Ω–Ω—ã—Ö

---

## üéØ –†–ï–ö–û–ú–ï–ù–î–ê–¶–ò–ò

### –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç 1 (–ö—Ä–∏—Ç–∏—á–Ω–æ):
1. ‚úÖ –ò—Å–ø—Ä–∞–≤–∏—Ç—å –∑–Ω–∞—á–µ–Ω–∏–µ `USO_TO_BRENT_MULTIPLIER` —Å 12 –Ω–∞ ~1.35
2. ‚úÖ –û–±–Ω–æ–≤–∏—Ç—å `FALLBACK_USD_RUB_RATE` —Å 80 –Ω–∞ 90-95
3. ‚úÖ –ü–µ—Ä–µ–Ω–µ—Å—Ç–∏ –≤—Å–µ –º–∞–≥–∏—á–µ—Å–∫–∏–µ —á–∏—Å–ª–∞ –≤ config.py

### –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç 2 (–í–∞–∂–Ω–æ):
4. ‚úÖ –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å —Å–∏—Å—Ç–µ–º—É —Ö—Ä–∞–Ω–µ–Ω–∏—è –ø–æ—Å–ª–µ–¥–Ω–∏—Ö –∏–∑–≤–µ—Å—Ç–Ω—ã—Ö –∑–Ω–∞—á–µ–Ω–∏–π
5. ‚úÖ –î–æ–±–∞–≤–∏—Ç—å –≤–∞–ª–∏–¥–∞—Ü–∏—é –¥–∏–∞–ø–∞–∑–æ–Ω–æ–≤ –¥–ª—è fallback –∑–Ω–∞—á–µ–Ω–∏–π
6. ‚úÖ –î–æ–±–∞–≤–∏—Ç—å –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é –ø—Ä–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–∏ fallback

### –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç 3 (–ñ–µ–ª–∞—Ç–µ–ª—å–Ω–æ):
7. ‚úÖ –î–æ–±–∞–≤–∏—Ç—å –º–µ—Ç—Ä–∏–∫–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è fallback –∑–Ω–∞—á–µ–Ω–∏–π
8. ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–æ–æ—Ç–Ω–æ—à–µ–Ω–∏–π –Ω–∞ –æ—Å–Ω–æ–≤–µ –∏—Å—Ç–æ—Ä–∏—á–µ—Å–∫–∏—Ö –¥–∞–Ω–Ω—ã—Ö
9. ‚úÖ –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä—É –ø—Ä–∏ —á–∞—Å—Ç–æ–º –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–∏ fallback

---

## üìù –ó–ê–ú–ï–¢–ö–ò

- –ó–Ω–∞—á–µ–Ω–∏–µ 80 –¥–ª—è USD/RUB –±—ã–ª–æ –∞–∫—Ç—É–∞–ª—å–Ω–æ –ø—Ä–∏–º–µ—Ä–Ω–æ –≤ **2015-2016 –≥–æ–¥–∞—Ö**
- –°–æ–æ—Ç–Ω–æ—à–µ–Ω–∏–µ –∑–æ–ª–æ—Ç–æ/—Å–µ—Ä–µ–±—Ä–æ 80:1 —è–≤–ª—è–µ—Ç—Å—è **—Å—Ä–µ–¥–Ω–∏–º –∏—Å—Ç–æ—Ä–∏—á–µ—Å–∫–∏–º**, –Ω–æ –º–æ–∂–µ—Ç —Å–∏–ª—å–Ω–æ –≤–∞—Ä—å–∏—Ä–æ–≤–∞—Ç—å—Å—è
- –ú–Ω–æ–∂–∏—Ç–µ–ª—å 12 –¥–ª—è USO‚ÜíBrent –≤—ã–≥–ª—è–¥–∏—Ç –∫–∞–∫ **–æ—à–∏–±–∫–∞** - –≤–æ–∑–º–æ–∂–Ω–æ, –∏–º–µ–ª–æ—Å—å –≤ –≤–∏–¥—É —á—Ç–æ-—Ç–æ –¥—Ä—É–≥–æ–µ

---

**–î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è:** 30.10.2025  
**–ê–≤—Ç–æ—Ä:** AI Assistant




