# üîß –û—Ç—á–µ—Ç –æ–± –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–∏ –ø—Ä–æ–±–ª–µ–º—ã —Å –∏–Ω–¥–µ–∫—Å–∞–º–∏ –ú–æ—Å–∫–æ–≤—Å–∫–æ–π –±–∏—Ä–∂–∏

## üö® –ü—Ä–æ–±–ª–µ–º–∞

–ò–Ω–¥–µ–∫—Å—ã –ú–æ—Å–∫–æ–≤—Å–∫–æ–π –±–∏—Ä–∂–∏ (IMOEX –∏ RTS) –æ—Ç–æ–±—Ä–∞–∂–∞–ª–∏—Å—å –Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –≤ –±–æ—Ç–µ. –ü—Ä–∏—á–∏–Ω–∞ –±—ã–ª–∞ –≤ –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ–º –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–∏ –ø–æ–ª–µ–π API –ú–æ—Å–∫–æ–≤—Å–∫–æ–π –±–∏—Ä–∂–∏.

## üîç –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞

### –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ API –ú–æ—Å–∫–æ–≤—Å–∫–æ–π –±–∏—Ä–∂–∏

–ü—Ä–æ–≤–µ–ª–∏ –¥–µ—Ç–∞–ª—å–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ API –∏ –≤—ã—è–≤–∏–ª–∏, —á—Ç–æ API –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç **—Ä–∞–∑–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è** –¥–ª—è —Ä–∞–∑–Ω—ã—Ö –ø–æ–ª–µ–π:

#### üìä IMOEX (–ø—Ä–∏–º–µ—Ä –¥–∞–Ω–Ω—ã—Ö):
- **LASTVALUE**: 3012.09 (–ø–æ—Å–ª–µ–¥–Ω—è—è —Ü–µ–Ω–∞)
- **CURRENTVALUE**: 2963.32 (—Ç–µ–∫—É—â–∞—è —Ü–µ–Ω–∞) 
- **OPENVALUE**: 2949.46 (—Ü–µ–Ω–∞ –æ—Ç–∫—Ä—ã—Ç–∏—è)
- **LASTCHANGEPRC**: -1.62% (–∏–∑–º–µ–Ω–µ–Ω–∏–µ —Å –ø—Ä–µ–¥—ã–¥—É—â–µ–≥–æ –¥–Ω—è)
- **LASTCHANGETOOPENPRC**: 0.47% (–∏–∑–º–µ–Ω–µ–Ω–∏–µ —Å –æ—Ç–∫—Ä—ã—Ç–∏—è)

#### üìä RTS (–ø—Ä–∏–º–µ—Ä –¥–∞–Ω–Ω—ã—Ö):
- **LASTVALUE**: 1185.76 (–ø–æ—Å–ª–µ–¥–Ω—è—è —Ü–µ–Ω–∞)
- **CURRENTVALUE**: 1166.57 (—Ç–µ–∫—É—â–∞—è —Ü–µ–Ω–∞)
- **OPENVALUE**: 1171.23 (—Ü–µ–Ω–∞ –æ—Ç–∫—Ä—ã—Ç–∏—è)
- **LASTCHANGEPRC**: -1.62% (–∏–∑–º–µ–Ω–µ–Ω–∏–µ —Å –ø—Ä–µ–¥—ã–¥—É—â–µ–≥–æ –¥–Ω—è)
- **LASTCHANGETOOPENPRC**: -0.40% (–∏–∑–º–µ–Ω–µ–Ω–∏–µ —Å –æ—Ç–∫—Ä—ã—Ç–∏—è)

## üõ†Ô∏è –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è

### 1. –ò–∑–º–µ–Ω–µ–Ω–∏–µ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–∞ –ø–æ–ª–µ–π –¥–ª—è —Ü–µ–Ω—ã

**–ë—ã–ª–æ:**
```python
'price': row_data['LASTVALUE']
```

**–°—Ç–∞–ª–æ:**
```python
'price': row_data.get('CURRENTVALUE', row_data['LASTVALUE'])
```

### 2. –ò–∑–º–µ–Ω–µ–Ω–∏–µ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–∞ –ø–æ–ª–µ–π –¥–ª—è –∏–∑–º–µ–Ω–µ–Ω–∏—è

**–ë—ã–ª–æ:**
```python
'change_pct': row_data.get('LASTCHANGEPRC', 0)
```

**–°—Ç–∞–ª–æ:**
```python
'change_pct': row_data.get('LASTCHANGETOOPENPRC', row_data.get('LASTCHANGEPRC', 0))
```

### 3. –£–ª—É—á—à–µ–Ω–∏–µ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –≤—ã—Ö–æ–¥–Ω—ã—Ö –¥–Ω–µ–π

**–ë—ã–ª–æ:**
```python
last_value = row_data.get('LASTVALUE') or row_data.get('PREVPRICE')
```

**–°—Ç–∞–ª–æ:**
```python
last_value = row_data.get('CURRENTVALUE') or row_data.get('LASTVALUE') or row_data.get('PREVPRICE')
```

## üìà –†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

### –î–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:
- IMOEX –ø–æ–∫–∞–∑—ã–≤–∞–ª LASTVALUE (3012.09) –≤–º–µ—Å—Ç–æ CURRENTVALUE (2963.32)
- RTS –ø–æ–∫–∞–∑—ã–≤–∞–ª LASTVALUE (1185.76) –≤–º–µ—Å—Ç–æ CURRENTVALUE (1166.57)
- –ò–∑–º–µ–Ω–µ–Ω–∏—è –æ—Ç–æ–±—Ä–∞–∂–∞–ª–∏—Å—å –Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ

### –ü–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:
- ‚úÖ IMOEX: 2965.86 (—Ç–µ–∫—É—â–∞—è —Ü–µ–Ω–∞)
- ‚úÖ RTS: 1167.55 (—Ç–µ–∫—É—â–∞—è —Ü–µ–Ω–∞)
- ‚úÖ –ò–∑–º–µ–Ω–µ–Ω–∏—è —Å –æ—Ç–∫—Ä—ã—Ç–∏—è: 0.56% –∏ -0.31% —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ
- ‚úÖ –í—Å–µ –¥–∞–Ω–Ω—ã–µ –≤–∞–ª–∏–¥–Ω—ã –∏ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã

## üéØ –ö–ª—é—á–µ–≤—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤ –∫–æ–¥–µ

### –§–∞–π–ª: `admin_bot.py`

#### –°—Ç—Ä–æ–∫–∏ 1176-1180 (IMOEX):
```python
indices_data['imoex'] = {
    'name': 'IMOEX',
    'price': row_data.get('CURRENTVALUE', row_data['LASTVALUE']),
    'change_pct': row_data.get('LASTCHANGETOOPENPRC', row_data.get('LASTCHANGEPRC', 0)),
    'update_time': update_time,
    'is_live': True
}
```

#### –°—Ç—Ä–æ–∫–∏ 1200-1204 (RTS):
```python
indices_data['rts'] = {
    'name': 'RTS',
    'price': row_data.get('CURRENTVALUE', row_data['LASTVALUE']),
    'change_pct': row_data.get('LASTCHANGETOOPENPRC', row_data.get('LASTCHANGEPRC', 0)),
    'update_time': update_time,
    'is_live': True
}
```

## üîß –õ–æ–≥–∏–∫–∞ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π

### –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç –ø–æ–ª–µ–π –¥–ª—è —Ü–µ–Ω—ã:
1. **CURRENTVALUE** - —Ç–µ–∫—É—â–∞—è —Ü–µ–Ω–∞ (—Å–∞–º–∞—è –∞–∫—Ç—É–∞–ª—å–Ω–∞—è)
2. **LASTVALUE** - –ø–æ—Å–ª–µ–¥–Ω—è—è —Ü–µ–Ω–∞ (fallback)
3. **PREVPRICE** - –ø—Ä–µ–¥—ã–¥—É—â–∞—è —Ü–µ–Ω–∞ (–¥–ª—è –≤—ã—Ö–æ–¥–Ω—ã—Ö)

### –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç –ø–æ–ª–µ–π –¥–ª—è –∏–∑–º–µ–Ω–µ–Ω–∏—è:
1. **LASTCHANGETOOPENPRC** - –∏–∑–º–µ–Ω–µ–Ω–∏–µ —Å –æ—Ç–∫—Ä—ã—Ç–∏—è (–±–æ–ª–µ–µ –∞–∫—Ç—É–∞–ª—å–Ω–æ)
2. **LASTCHANGEPRC** - –∏–∑–º–µ–Ω–µ–Ω–∏–µ —Å –ø—Ä–µ–¥—ã–¥—É—â–µ–≥–æ –¥–Ω—è (fallback)

## ‚úÖ –°—Ç–∞—Ç—É—Å

- ‚úÖ –ü—Ä–æ–±–ª–µ–º–∞ –∏–¥–µ–Ω—Ç–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω–∞
- ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –≤–Ω–µ—Å–µ–Ω—ã
- ‚úÖ –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–æ –∏ —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
- ‚úÖ –î–∞–Ω–Ω—ã–µ –æ—Ç–æ–±—Ä–∞–∂–∞—é—Ç—Å—è –∞–∫—Ç—É–∞–ª—å–Ω–æ

## üìä –¢–µ—Å—Ç–æ–≤—ã–µ —Ñ–∞–π–ª—ã

–°–æ–∑–¥–∞–Ω—ã —Ç–µ—Å—Ç–æ–≤—ã–µ —Ñ–∞–π–ª—ã –¥–ª—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏:
- `test_moex_indices.py` - –±–∞–∑–æ–≤–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ API
- `test_moex_indices_fixed.py` - —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Å –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è–º–∏
- `test_indices_simple.py` - —É–ø—Ä–æ—â–µ–Ω–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

## üöÄ –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏

1. **–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥**: –†–µ–≥—É–ª—è—Ä–Ω–æ –ø—Ä–æ–≤–µ—Ä—è—Ç—å –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç—å –¥–∞–Ω–Ω—ã—Ö –∏–Ω–¥–µ–∫—Å–æ–≤
2. **–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è**: –û–±–Ω–æ–≤–∏—Ç—å –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é API –ú–æ—Å–∫–æ–≤—Å–∫–æ–π –±–∏—Ä–∂–∏
3. **Fallback**: –°–æ—Ö—Ä–∞–Ω–∏—Ç—å —Ç–µ–∫—É—â—É—é –ª–æ–≥–∏–∫—É fallback –¥–ª—è –Ω–∞–¥–µ–∂–Ω–æ—Å—Ç–∏
4. **–õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ**: –î–æ–±–∞–≤–∏—Ç—å –¥–µ—Ç–∞–ª—å–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏

---

**–î–∞—Ç–∞ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:** 18.08.2025  
**–°—Ç–∞—Ç—É—Å:** ‚úÖ –ó–∞–≤–µ—Ä—à–µ–Ω–æ  
**–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ:** ‚úÖ –ü—Ä–æ–π–¥–µ–Ω–æ
